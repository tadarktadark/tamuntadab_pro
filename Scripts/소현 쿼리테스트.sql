--TDF019	TDW55411	필기 검색
--TDF019	TDW55412	필기 목록 조회
SELECT PIBO_ID , PIBO_WRITER_ID , PIBO_CLAS_ID , 
		CLAS_TITLE , 
	PIBO_LIKE_USER , PIBO_VIEW_USER , PIBO_VIEW_GROUP , PIBO_REGDATE , CLAS_SUBJECT_JEONGBO
	FROM PILGI_BOARD pb JOIN CLASS c
	ON pb.PIBO_CLAS_ID = c.CLAS_ID 
	WHERE PIBO_DELFLAG = 'N';

SELECT *
	FROM COMMUNITY_REPLY;
--TDF019	TDW55413	필기 정렬
--TDF019	TDW55414	필기 상세 조회
--TDF019	TDW55415	연관 필기/질문 목록 조회
--TDF019	TDW51530	필기 좋아요 조회
--TDF019	TDW51510	필기 좋아요 업데이트
--TDF019	TDW51620	필기 조회수 조회
--TDF019	TDW51610	필기 조회수 업데이트
--TDF019	TDW55416	(마이페이지)내가 쓴 필기 목록 조회
--TDF019	TDW55416	(마이페이지)좋아요한 필기 목록 조회
--TDF019	TDW55421	필기 작성시 기본 정보 조회
--TDF019	TDW55420	필기 작성
--TDF019	TDW55420	필기 수정
--TDF019	TDW55431	필기 임시 삭제
--TDF019	TDW55431	필기 복원
--TDF019	TDW55432	필기 완전 삭제
--TDF019	TDW55441	댓글 조회
--TDF019	TDW55441	댓글 작성
--TDF019	TDW55441	댓글 수정
--TDF019	TDW55441	댓글 삭제
--TDF020	TDW55411	질문 검색
--TDF020	TDW55412	질문 목록 조회
--TDF020	TDW55413	질문 정렬
--TDF020	TDW55414	질문 상세 조회
--TDF020	TDW51530	질문 좋아요 조회
--TDF020	TDW51510	질문 좋아요 업데이트
--TDF020	TDW51620	질문 조회수 조회
--TDF020	TDW51610	질문 조회수 업데이트
--TDF020	TDW55416	(마이페이지)내가 쓴 질문 목록 조회
--TDF020	TDW55416	(마이페이지)좋아요한 질문 목록 조회
--TDF020	TDW55421	질문 작성 클랙스 선택시 관련 과목 조회
--TDF020	TDW55420	질문 작성
--TDF020	TDW55420	질문 수정
--TDF020	TDW55432	질문 완전 삭제
--TDF020	TDW55444	질문 채택
--TDF021	TDW55411	자유 검색
--TDF021	TDW55412	자유 목록 조회
--TDF021	TDW55413	자유 정렬
--TDF021	TDW55414	자유 상세 조회
--TDF021	TDW51530	자유 좋아요 조회
--TDF021	TDW51510	자유 좋아요 업데이트
--TDF021	TDW51620	자유 조회수 조회
--TDF021	TDW51610	자유 조회수 업데이트
--TDF021	TDW55416	(마이페이지)내가 쓴 자유 목록 조회
--TDF021	TDW55416	(마이페이지)좋아요한 자유 목록 조회
--TDF021	TDW55421	자유 작성
--TDF021	TDW55420	자유 수정
--TDF021	TDW55432	자유 완전 삭제
--TDF025	TDW55531	게시글 또는 댓글 신고
--TDF025	TDW55532	신고된 게시글 조회
--TDF033	TDW59110	강의실 건물 시도 조회
SELECT GACO_SIDO || '(' || COUNT(GACO_SIDO) || ')'
	FROM GANGEUISIL_COMM
	GROUP BY GACO_SIDO
	ORDER BY GACO_SIDO;

--TDF033	TDW59110	강의실 시군구 조회
SELECT GACO_SIGUNGU || '(' || COUNT(GACO_SIGUNGU) || ')'
	FROM GANGEUISIL_COMM
	WHERE GACO_SIDO='대전'
	GROUP BY GACO_SIGUNGU;

--TDF033	TDW59110	강의실 목록 조회
SELECT GACO_ID , GACO_NAME , GACO_JUSO , GACO_LAT , GACO_LON , GACO_OPEN , GACO_CLOSE
	FROM GANGEUISIL_COMM
	WHERE GACO_SIDO='서울'
		AND GACO_SIGUNGU='종로구';
	
--TDF033	TDW59120	강의실 상세 조회
SELECT GAGA_ID, GAGA_GACO_ID AS GACO_ID, GAGA_NAME, GAGA_MAX, GAGA_HOUR_PRICE 
	FROM GANGEUISIL_GAEBYEOL
	WHERE GAGA_GACO_ID = 'GACO00001';

--TDF033	TDW59130	예약 가능한 날짜 조회
SELECT GAYE_YEYAK_DATE, GAYE_START_TIME , GAYE_HOURS 
	FROM GANGEUISIL_YEYAK
	WHERE GAYE_GAGA_ID = 'GAGA00277'
		AND GAYE_YEYAK_DATE > TO_CHAR(CURRENT_DATE ,'yyyyddmm');

--TDF033	TDW59130	예약 가능한 시간 조회
SELECT GAYE_ID, GAYE_GAGA_ID , GAYE_ACCOUNT_ID , GAYE_YEYAK_DATE , GAYE_START_TIME , GAYE_HOURS
	FROM GANGEUISIL_YEYAK
	WHERE GAYE_GAGA_ID = 'GAGA00265'
		AND GAYE_YEYAK_DATE = TO_CHAR(TO_DATE('20230911'),'yyyymmdd')
		AND NOT GAYE_STATE = 'N';

--TDF033	TDW59140	예약 정보 입력 클래스 ID가 있는 경우/없는 경우
-- 'TMTD'||LPAD(SUBSTR('TMTD00011',INSTR('TMTD00011', '0', -1)+1)+1,5,'0');
(SELECT 'YY'||TO_CHAR(CURRENT_DATE,'yyyymmdd')||LPAD(MAX(TO_NUMBER(SUBSTR(GAYE_ID,11)))+1,4,'0')
	FROM GANGEUISIL_YEYAK
	WHERE SUBSTR(GAYE_ID,1,10)='YY'||TO_CHAR(CURRENT_DATE,'yyyymmdd'));

INSERT INTO GANGEUISIL_YEYAK
			(GAYE_ID, GAYE_GAGA_ID, GAYE_ACCOUNT_ID, 
			GAYE_PHONE_NUMBER, GAYE_YEYAK_DATE, GAYE_START_TIME, 
			GAYE_HOURS, GAYE_STATE, GAYE_CLAS_ID, 
			GAYE_GYEOLJE_TYPE, GAYE_GYEOLJE_USER)
	VALUES((SELECT 'YY'||TO_CHAR(CURRENT_DATE,'yyyymmdd')||LPAD(MAX(TO_NUMBER(SUBSTR(GAYE_ID,11)))+1,4,'0')
	FROM GANGEUISIL_YEYAK
	WHERE SUBSTR(GAYE_ID,1,10)='YY'||TO_CHAR(CURRENT_DATE,'yyyymmdd')), 'GAGA00271', 'TMTD1', '01000000001', '20230913', '1400', 2, 'D' , 1000000013, 'B', '{"TMTD1":"N","TMTD2":"N","TMTD3":"N","TMTD4":"N","TMTD5":"N"}');
INSERT INTO GANGEUISIL_YEYAK
			(GAYE_ID, GAYE_GAGA_ID, GAYE_ACCOUNT_ID, 
			GAYE_PHONE_NUMBER, GAYE_YEYAK_DATE, GAYE_START_TIME, 
			GAYE_HOURS, GAYE_STATE,
			GAYE_GYEOLJE_TYPE, GAYE_GYEOLJE_USER)
	VALUES((SELECT 'YY'||TO_CHAR(CURRENT_DATE,'yyyymmdd')||LPAD(MAX(TO_NUMBER(SUBSTR(GAYE_ID,11)))+1,4,'0')
	FROM GANGEUISIL_YEYAK
	WHERE SUBSTR(GAYE_ID,1,10)='YY'||TO_CHAR(CURRENT_DATE,'yyyymmdd')), 'GAGA00271', 'TMTD1', '01000000001', '20230913', '1400', 2, 'D' , 'B', '{"TMTD1":"N","TMTD2":"N","TMTD3":"N","TMTD4":"N","TMTD5":"N"}');

-- 예약 정보 입력 후 입력한 정보의 gaye_id 값 가져오기
SELECT MAX(GAYE_ID)
	FROM GANGEUISIL_YEYAK;

-- 예약한 클래스의 학생 참여자들 ACCOUNT_ID 조회
SELECT CLCH_ACCOUNT_ID 
	FROM CLASS_CHAMYEOJA
	WHERE CLCH_CLAS_ID =1000000013
		AND CLCH_STATUS = 'Y'
		AND NOT CLCH_YEOKAL = 'I';

-- 결제 insert, 클래스원 전부 for문
(SELECT 'RE'||TO_CHAR(MAX(SUBSTR(GYEO_ID, 3))+1)
	FROM GYEOLJE);
INSERT INTO GYEOLJE
		(GYEO_ID, GYEO_GEUMAEK, GYEO_DAESANG_ID, 
		GYEO_ACCOUNT_ID, GYEO_REGDATE, GYEO_WANRYOIL, 
		GYEO_BANGBEOP, GYEO_STATUS)
	VALUES((SELECT 'RE'||TO_CHAR(MAX(SUBSTR(GYEO_ID, 3))+1)
	FROM GYEOLJE), 60000, 'YY202309080006', 
		'TDTD1', CURRENT_DATE , CURRENT_DATE+3, 
		'P', 'W' );

-- 내 예약 목록 조회(GAYE_ACCOUNT_ID가 로그인 유저랑 같다면 취소 버튼)
SELECT GAYE_ID, GAYE_GAGA_ID, GAYE_ACCOUNT_ID , GAYE_PHONE_NUMBER , GAYE_YEYAK_DATE , GAYE_START_TIME , GAYE_HOURS , GAYE_STATE , GAYE_CLAS_ID , GAYE_GYEOLJE_TYPE , GAYE_GYEOLJE_USER  
	FROM GANGEUISIL_YEYAK
	WHERE GAYE_GYEOLJE_USER LIKE '%TMTD1%';

--TDF033	TDW59150	예약 취소
UPDATE GANGEUISIL_YEYAK SET GAYE_STATE='N'
	WHERE GAYE_ID='YY2023090006';